# CRDT Delta Consumer Test Framework
# Reads test deltas generated by js-delta-generator and validates against libyrs

CC = g++
CFLAGS = -O2 -fopenmp -pthread -Wall -Wextra -std=c++11
INCLUDES = -I/usr/include -I/usr/local/include
LIBDIRS = -L/usr/lib -L/usr/local/lib
LIBS = -lyrs

TARGET = test-deltas
TEST_RUNNER = ./test-runner.sh

.PHONY: all clean test test-verbose run help

all: $(TARGET)

$(TARGET): test-deltas.cpp
	@echo "Compiling delta consumer test..."
	$(CC) $(CFLAGS) $(INCLUDES) test-deltas.cpp $(LIBDIRS) $(LIBS) -o $(TARGET)
	@echo "Build complete: $(TARGET)"

test: $(TARGET)
	@echo "Running delta tests..."
	@$(TEST_RUNNER)

test-verbose: $(TARGET)
	@echo "Running delta tests (verbose)..."
	@$(TEST_RUNNER) --verbose

run: test

clean:
	rm -f $(TARGET)
	@echo "Cleaned build artifacts"

help:
	@echo "CRDT Delta Consumer Makefile"
	@echo "============================"
	@echo "make               - Build the test consumer"
	@echo "make test          - Build and run all tests (summary)"
	@echo "make test-verbose  - Build and run all tests (verbose)"
	@echo "make clean         - Remove build artifacts"
	@echo ""
	@echo "Direct usage:"
	@echo "  ./test-deltas <test-dir>       - Run single test"
	@echo "  ./test-runner.sh               - Run all tests (summary)"
	@echo "  ./test-runner.sh --verbose     - Run all tests (verbose)"

