version: "3.9"

services:
  server:
    build:
      target: dev
    command: sh -c "make clean && make && LD_LIBRARY_PATH=/usr/local/lib ./crdt_server 9000"
    volumes:
      - ./server:/app
    restart: "no"

  web:
    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port 3000"
    environment:
      - VITE_SERVER_URL=ws://localhost:${SERVER_PORT:-9000}
    restart: "no"